#include <Uefi.h>
#include <Library/PcdLib.h>
#include <Library/UefiLib.h>
#include <Library/DebugLib.h>
#include <Library/UefiApplicationEntryPoint.h>
#include <Library/UefiBootServicesTableLib.h>

typedef struct {
    EFI_STATUS (*function1)(void*, UINT16*, UINT8*, UINT8);
} MyInterface;

MyInterface myInstance;



EFI_STATUS LTSProt(void* this, UINT16* data, UINT8* size, UINT8 offset){
    Print(L"\n");
    Print(L"Hello World Inside LTSProt .\n");

    INT64 **BootOptionsProt;
    EFI_GUID gBootOptionsProtocol = {0x5962af91, 0x4456, 0x419f, {0xa7, 0xb9, 0x1f, 0x4f, 0x89, 0x2a, 0xb0, 0xf6}};
    EFI_STATUS stat = gBS->LocateProtocol(&gBootOptionsProtocol, (void *)0x0, (void**)&BootOptionsProt);
    Print(L"Satus of LocateProtocol: %d\n", stat);
    if (stat != EFI_SUCCESS) {
        Print(L"Failed to locate BootOptionsProtocol!\n");
        return EFI_SUCCESS;
    }
    EFI_STATUS status = ((EFI_STATUS(*)(void *, UINT8, UINT8*, unsigned long long))(*(void**)BootOptionsProt))(BootOptionsProt, (UINT8)0x31,(UINT8*) 0x43, (unsigned long long)offset);
    Print(L"Status of BootOptionsProtocol: %d\n", status);
    return EFI_SUCCESS;
}
/**
  The user Entry Point for Application. The user code starts with this function
  as the real entry point for the application.

  @param[in] ImageHandle    The firmware allocated handle for the EFI image.
  @param[in] SystemTable    A pointer to the EFI System Table.

  @retval EFI_SUCCESS       The entry point is executed successfully.
  @retval other             Some error occurs when executing this entry point.

**/
EFI_STATUS
EFIAPI
UefiMain (
  IN EFI_HANDLE        ImageHandle,
  IN EFI_SYSTEM_TABLE  *SystemTable
  )
{
    EFI_BOOT_SERVICES *gBS = SystemTable->BootServices;

    EFI_GUID gLenovoTranslateService = {0xe3abb023, 0xb8b1, 0x4696, {0x98, 0xe1, 0x8e, 0xed, 0xc3, 0xd3, 0xc6, 0x3d}};
    EFI_GUID EfiLoadedImageProtocolGuid = {0x5B1B31A1, 0x9562, 0x11d2, {0x8e, 0x3f, 0x00, 0xa0, 0xc9, 0x69, 0x72, 0x3b}};
    
    void *local_res8;
    local_res8 = (void*) 0x0;

    (*gBS->HandleProtocol)(ImageHandle, (EFI_GUID *)&EfiLoadedImageProtocolGuid, &local_res8);



    myInstance.function1 = &LTSProt;
    (*gBS->InstallProtocolInterface)((EFI_HANDLE *)&ImageHandle, (EFI_GUID *)&gLenovoTranslateService, EFI_NATIVE_INTERFACE, (void*)&myInstance.function1);

    return EFI_SUCCESS;
}
